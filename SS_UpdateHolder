// This will be an an NPC that can increase the bonus of your item by following a 
// pool of riddles then completing a nifty quest. 
// he will be a shadow but show himself when you answer three riddles correctly.

If shard equipped NPC visible

ask 3 riddles. Completion stays.

riddles complete, collect materials?

Increase shard bonus stats by an amount or maybe instantly level it?


{ OnNPCKillEvent: SSExperienceHandler(); }, {  }, { }




/**
 * Each time a shard is equipped update the `holder_id` and
 * `holder_name` 
 * @param item_id An integer value indicating the item.
 */
function  script  SS_UpdateHolder {
    // Function declarations.
    function getShardID;
    function getShardKey;

    // Data definitions.
    .@SHARD_ID = getShardID;
    .@SHARD_KEY = getShardKey;
    
    // --- MAIN CALL
    // Update the `holder_id` and `holder_name` fields
    // with attached player data.
    query_sql("
        UPDATE `shard`
        SET `holder_id` = "+ getchardid(0) +", `holder_name` = '"+ strcharid(0) +"'
        WHERE `id` = " + .@SHARD_KEY
    );
    return;
    
    
    
    // MAIN FUNCTIONS
    // ================================================================================
    /**
     * Returns the item_id parameter.
     */
    function getShardID {
        return getarg(0);
    }



    /**
     * Checks the attached player's equipment for the
     * parameter item_id. If it is found, returns the
     * equipment slot then returns the stored id.
     */
    function getShardKey {
        // Obtain the equip slot.
        if(getequipid(EQI_ACC_L) == .@SHARD_ID)
            .@equipSlot = EQI_ACC_L;
        else
            .@equipSlot = EQI_ACC_R;

        // Return the shard key.
        .@shard_key = (getequipcardid(.@equipSlot, 4) << 16) + getequipcardid(.@equipSlot, 3));
        return .@shard_key;
    }
}
